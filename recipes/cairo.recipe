# -*- Mode: Python -*- vi:si:et:sw=4:sts=4:ts=4:syntax=python
from cerbero.tools.libtool import LibtoolLibrary


class Recipe(recipe.Recipe):
    name = 'cairo'
    version = '1.16.0'
    #stype = SourceType.TARBALL
    #url = 'https://cairographics.org/releases/cairo-%(version)s.tar.xz'
    #tarball_checksum = '8c90f00c500b2299c0a323dd9beead2a00353752b2092ead558139bd67f7bf16'
    btype = BuildType.MESON
    remotes = {'origin': 'https://github.com/centricular/%(name)s.git'}
    commit = 'origin/meson-1.16.0'
    # either LGPLv2.1 or MPLv1.1
    licenses = [License.LGPLv2_1]
    meson_options = {'tests': 'disabled'}
    deps = ['glib', 'libpng', 'zlib', 'pixman', 'fontconfig', 'freetype']
    patches = [name + '/0001-meson-Temporarily-disable-gl-support-for-windows.patch']

    files_libs = ['libcairo', 'libcairo-gobject']
    files_devel = [
        'lib/pkgconfig/cairo-fc.pc',
        'lib/pkgconfig/cairo.pc',
        'lib/pkgconfig/cairo-ps.pc',
        'lib/pkgconfig/cairo-ft.pc',
        'lib/pkgconfig/cairo-pdf.pc',
        'lib/pkgconfig/cairo-svg.pc',
        'lib/pkgconfig/cairo-gobject.pc',
        'lib/pkgconfig/cairo-png.pc',
        'include/cairo',
        ]
    platform_files_devel = {
        Platform.WINDOWS: [ 'lib/pkgconfig/cairo-win32-font.pc',
                            'lib/pkgconfig/cairo-win32.pc'],
        Platform.DARWIN: ['lib/pkgconfig/cairo-quartz-font.pc',
                         'lib/pkgconfig/cairo-quartz-image.pc',
                         'lib/pkgconfig/cairo-quartz.pc']
    }

    def prepare(self):
        if self.config.variants.x11:
            self.files_devel += ['lib/pkgconfig/cairo-xlib-xrender.pc',
                                 'lib/pkgconfig/cairo-xlib.pc']
        #else:
            #self.configure_options += '--without-x '
        #if self.config.target_platform == Platform.DARWIN:
        #    self.configure_options += ' --enable-quartz-font --enable-quartz-image'

    def post_install (self):
        cairo_deps = ['pixman-1', 'fontconfig', 'freetype', 'expat', 'bz2', 'png16', 'z']
        if self.config.target_platform == Platform.WINDOWS:
            cairo_deps += ['-lgdi32', '-lmsimg32']
        lib = LibtoolLibrary('cairo', None, None, None, self.config.libdir,
                self.config.target_platform, deps=cairo_deps)
        lib.save()
        gobject_deps = ['gobject-2.0', 'glib-2.0', 'ffi', 'intl']
        lib = LibtoolLibrary('cairo-gobject', None, None, None, self.config.libdir,
                self.config.target_platform, deps=(cairo_deps + gobject_deps))
        lib.save()
